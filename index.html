<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Data Sheet Bangunan</title>
  <style>
    body{margin:0;font-family:sans-serif;background:#0b1020;color:#e5e7eb}
    header{padding:20px;text-align:center}
    .container{max-width:1200px;margin:0 auto;padding:16px}
    table{width:100%;border-collapse:collapse;margin-top:16px}
    th,td{padding:8px 12px;border:1px solid #1e293b;text-align:left}
    th{background:#1f2937;color:#93c5fd}
    tr:nth-child(even){background:#111827}
    input{padding:6px 10px;border-radius:6px;border:1px solid #374151;background:#0f172a;color:#e5e7eb}
    .status{margin-top:12px;font-size:14px;color:#94a3b8}
  </style>
</head>
<body>
  <header>
    <h1>üìÑ Data Bangunan</h1>
    <p>Menarik data langsung dari Google Sheet <b>"Bangunan"</b></p>
  </header>

  <main class="container">
    <div>
      <input id="search" placeholder="üîç Cari data..." style="width:300px" />
    </div>
    <div id="status" class="status">Memuat data‚Ä¶</div>
    <div style="overflow:auto;max-height:70vh">
      <table id="dataTable"></table>
    </div>
  </main>

  <script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbynYXMbmz5aTaNuIoED7fPMjFwJDmsbLxuBy_qzMzywr5k9fSh-i6ZqaVn-iwoITaKUaw/exec"; // ganti dengan URL WebApp Apps Script
    let allData = [];
    let filteredData = [];

    async function loadData() {
      try {
        const res = await fetch(`${WEB_APP_URL}?action=getData&sheet=Bangunan`);
        const rawData = await res.json();
        allData = rawData.map(d => ({
          kodeBarang: d["Kode Barang"] || "",
          namaBarang: d["Nama Barang"] || "",
          nibar: d["NIBAR"] || "",
          noRegister: d["Nomor Register"] || "",
          spesifikasiNama: d["Spesifikasi Nama Barang"] || "",
          spesifikasiLain: d["Spesifikasi Lainnya"] || "",
          lokasi: d["Lokasi"] || "",
          jumlah: d["Jumlah"] || "",
          satuan: d["Satuan"] || "",
          nilaiPerolehan: d["Nilai Perolehan (Rp)"] || "",
          tanggalPerolehan: d["Tanggal Perolehan"] || "",
          statusPenggunaan: d["Status Penggunaan"] || "",
          keterangan: d["Keterangan"] || "",
          dokumen: d["LINK DOKUMEN"] || "",
          namaSatuan: d["Nama Satuan"] || "",
          jenjang: d["Jenjang"] || "",
          kecamatan: d["Kecamatan"] || ""
        }));
        filteredData = allData;
        renderTable();
        document.getElementById('status').textContent =
          `Berhasil memuat ${allData.length} baris data.`;
      } catch (err) {
        console.error(err);
        document.getElementById('status').textContent =
          "‚ùå Gagal memuat data. Pastikan Web App publik.";
      }
    }

    function renderTable() {
      const table = document.getElementById("dataTable");
      table.innerHTML = "";
      if (!filteredData.length) {
        table.innerHTML = "<tr><td colspan='16'>Tidak ada data</td></tr>";
        return;
      }
      const headers = Object.keys(filteredData[0]);
      const thead = document.createElement("thead");
      const trh = document.createElement("tr");
      headers.forEach(h => {
        const th = document.createElement("th");
        th.textContent = h;
        trh.appendChild(th);
      });
      thead.appendChild(trh);
      table.appendChild(thead);

      const tbody = document.createElement("tbody");
      filteredData.forEach(r => {
        const tr = document.createElement("tr");
        headers.forEach(h => {
          const td = document.createElement("td");
          if (h === "dokumen" && r[h]) {
            const a = document.createElement("a");
            a.href = r[h];
            a.textContent = "üìé Dokumen";
            a.target = "_blank";
            td.appendChild(a);
          } else {
            td.textContent = r[h];
          }
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);
    }

    document.getElementById("search").addEventListener("input", e => {
      const q = e.target.value.toLowerCase();
      filteredData = allData.filter(r =>
        Object.values(r).some(v => String(v).toLowerCase().includes(q))
      );
      renderTable();
    });

    window.addEventListener("DOMContentLoaded", loadData);
  </script>
</body>
</html>
