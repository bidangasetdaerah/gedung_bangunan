<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Data Sheet Bangunan</title>
  <style>
    body{margin:0;font-family:sans-serif;background:#ffffff;color:#111827}
    header{padding:20px;text-align:center;background:#f9fafb;border-bottom:1px solid #e5e7eb}
    .container{max-width:1200px;margin:0 auto;padding:16px}
    table{width:100%;border-collapse:collapse;margin-top:16px;font-size:14px}
    th,td{padding:8px 12px;border:1px solid #d1d5db;text-align:left}
    th{background:#f3f4f6;color:#111827;position:sticky;top:0;z-index:1}
    tr:nth-child(even){background:#f9fafb}
    input, select{padding:6px 10px;border-radius:6px;border:1px solid #d1d5db;background:#ffffff;color:#111827}
    .status{margin-top:12px;font-size:14px;color:#374151}
    .pagination{margin-top:12px;text-align:center}
    .pagination button{margin:0 4px;padding:6px 12px;border:1px solid #d1d5db;border-radius:6px;background:#f3f4f6;color:#111827;cursor:pointer}
    .pagination button:disabled{background:#e5e7eb;color:#9ca3af;cursor:not-allowed}
  </style>
</head>
<body>
  <header>
    <h1>üìÑ Data Bangunan</h1>
    <p>Menarik data langsung dari Google Sheet <b>"Bangunan"</b></p>
  </header>

  <main class="container">
    <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
      <input id="search" placeholder="üîç Cari data..." style="width:300px" />
      <label>
        Tampilkan
        <select id="rowsPerPageSelect">
          <option value="25">25</option>
          <option value="50" selected>50</option>
          <option value="100">100</option>
        </select>
        baris
      </label>
    </div>
    <div id="status" class="status">Memuat data‚Ä¶</div>
    <div style="overflow:auto;max-height:70vh">
      <table id="dataTable"></table>
    </div>
    <div class="pagination" id="pagination"></div>
  </main>

  <script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbynYXMbmz5aTaNuIoED7fPMjFwJDmsbLxuBy_qzMzywr5k9fSh-i6ZqaVn-iwoITaKUaw/exec";

    let allData = [];
    let filteredData = [];
    let currentPage = 1;
    let rowsPerPage = 50;

    async function loadData() {
      try {
        const res = await fetch(`${WEB_APP_URL}?action=getData&sheet=Bangunan`);
        const rawData = await res.json();
        allData = rawData;
        filteredData = allData;
        currentPage = 1;
        renderTable();
        renderPagination();
        document.getElementById('status').textContent =
          `‚úÖ Berhasil memuat ${allData.length} baris data.`;
      } catch (err) {
        console.error(err);
        document.getElementById('status').textContent =
          "‚ùå Gagal memuat data. Pastikan Web App sudah deploy & publik.";
      }
    }

    function renderTable() {
      const table = document.getElementById("dataTable");
      table.innerHTML = "";
      if (!filteredData.length) {
        table.innerHTML = "<tr><td colspan='16'>Tidak ada data</td></tr>";
        return;
      }
      const headers = Object.keys(filteredData[0]);

      const start = (currentPage - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      const pageData = filteredData.slice(start, end);

      // buat header
      const thead = document.createElement("thead");
      const trh = document.createElement("tr");
      headers.forEach(h => {
        const th = document.createElement("th");
        th.textContent = h;
        trh.appendChild(th);
      });
      thead.appendChild(trh);
      table.appendChild(thead);

      // isi data
      const tbody = document.createElement("tbody");
      pageData.forEach(r => {
        const tr = document.createElement("tr");
        headers.forEach(h => {
          const td = document.createElement("td");
          if (h === "LINK DOKUMEN" && r[h]) {
            const a = document.createElement("a");
            a.href = r[h];
            a.textContent = "üìé Dokumen";
            a.target = "_blank";
            td.appendChild(a);
          } else {
            td.textContent = r[h];
          }
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);
    }

    function renderPagination() {
      const pagination = document.getElementById("pagination");
      pagination.innerHTML = "";
      const totalPages = Math.ceil(filteredData.length / rowsPerPage);

      const prevBtn = document.createElement("button");
      prevBtn.textContent = "‚¨ÖÔ∏è Prev";
      prevBtn.disabled = currentPage === 1;
      prevBtn.onclick = () => { currentPage--; renderTable(); renderPagination(); };
      pagination.appendChild(prevBtn);

      const info = document.createElement("span");
      info.textContent = ` Halaman ${currentPage} dari ${totalPages} `;
      pagination.appendChild(info);

      const nextBtn = document.createElement("button");
      nextBtn.textContent = "Next ‚û°Ô∏è";
      nextBtn.disabled = currentPage === totalPages;
      nextBtn.onclick = () => { currentPage++; renderTable(); renderPagination(); };
      pagination.appendChild(nextBtn);
    }

    document.getElementById("search").addEventListener("input", e => {
      const q = e.target.value.toLowerCase();
      filteredData = allData.filter(r =>
        Object.values(r).some(v => String(v).toLowerCase().includes(q))
      );
      currentPage = 1;
      renderTable();
      renderPagination();
    });

    document.getElementById("rowsPerPageSelect").addEventListener("change", e => {
      rowsPerPage = parseInt(e.target.value, 10);
      currentPage = 1;
      renderTable();
      renderPagination();
    });

    window.addEventListener("DOMContentLoaded", loadData);
  </script>
</body>
</html>
